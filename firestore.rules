rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ğŸ”‘ All logged-in users
    function isSignedIn() {
      return request.auth != null;
    }

    // ğŸ”‘ Admin (email-based)
    function isAdmin() {
      return request.auth != null
        && request.auth.token.email == "admin@smartattend.com";
    }
    
    // ğŸ¢ Institution Profile (publicly readable)
    match /institution/{profileId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // ğŸ‘©â€ğŸ« Teachers collection (doc id = email)
    match /teachers/{email} {
      allow read: if isSignedIn() && request.auth.token.email == email;
      allow write: if isAdmin();
    }

    // ğŸ“ Students collection (email is a field, not doc id)
    match /students/{studentId} {
      allow read: if isSignedIn();
      allow write: if isAdmin();
    }

    // No other rules are defined, so other collections will be inaccessible.
    // This is intentional to fix the login issue as per user instructions.
    // Additional rules for collections like 'attendance' will need to be added later.

    // ğŸ”’ Deny everything else not explicitly allowed
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
