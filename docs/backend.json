
{
  "entities": {
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student in the attendance system.",
      "properties": {
        "registerNumber": {
          "type": "string",
          "description": "Unique identifier for the student. (e.g., 324cs21001)",
          "format": "string"
        },
        "name": {
          "type": "string",
          "description": "The student's full name."
        },
        "fatherName": {
          "type": "string",
          "description": "The student's father's name."
        },
        "motherName": {
          "type": "string",
          "description": "The student's mother's name."
        },
        "department": {
          "type": "string",
          "description": "The department the student belongs to (e.g., cs, ce, me).",
          "format": "string"
        },
        "semester": {
          "type": "number",
          "description": "The current semester of the student (e.g., 1, 2, ... 8)."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the student's photo in Firebase Storage.",
          "format": "uri"
        },
        "email": {
          "type": "string",
          "description": "The student's email address.",
          "format": "email"
        },
        "contact": {
          "type": "string",
          "description": "The student's contact phone number."
        },
        "faceId": {
          "type": "string",
          "description": "Optional ID for matching with OpenCV backend.  References the embeddings stored elsewhere."
        },
        "uid": {
          "type": "string",
          "description": "The Firebase Authentication user ID."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the student record was created.",
          "format": "date-time"
        }
      },
      "required": [
        "registerNumber",
        "name",
        "fatherName",
        "motherName",
        "department",
        "semester",
        "photoURL",
        "email",
        "contact",
        "createdAt"
      ]
    },
    "Attendance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Attendance",
      "type": "object",
      "description": "Represents an attendance record for a student on a specific date.",
      "properties": {
        "studentRegister": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Attendance)"
        },
        "date": {
          "type": "string",
          "description": "Date of the attendance record (YYYY-MM-DD).",
          "format": "string"
        },
        "status": {
          "type": "string",
          "description": "Attendance status (present, absent, late, manual)."
        },
        "markedBy": {
          "type": "string",
          "description": "Admin email or camera that marked the attendance."
        },
        "method": {
          "type": "string",
          "description": "Method used to mark attendance (face-scan, manual)."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the attendance was recorded.",
          "format": "date-time"
        }
      },
      "required": [
        "studentRegister",
        "date",
        "status",
        "markedBy",
        "method",
        "timestamp"
      ]
    },
    "Teacher": {
      "title": "Teacher",
      "description": "Represents a teacher in the system.",
      "type": "object",
      "properties": {
        "teacherId": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "department": {
          "type": "string"
        },
        "position": {
          "type": "string"
        },
        "profilePhotoUrl": {
          "type": "string",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        },
        "subjects": {
          "type": "object",
          "description": "Mapping of semester number to a list of assigned subjects.",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "required": [
        "teacherId",
        "name",
        "email",
        "department",
        "createdAt"
      ]
    },
    "AdminRole": {
      "title": "Admin Role",
      "description": "A document indicating a user has admin privileges.",
      "type": "object",
      "properties": {
        "isAdmin": {
          "type": "boolean",
          "description": "Should always be true."
        }
      },
      "required": [
        "isAdmin"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/students/{registerNumber}",
        "definition": {
          "entityName": "Student",
          "schema": {
            "$ref": "#/backend/entities/Student"
          },
          "description": "Stores student profile information. Document ID is the student's register number.  No denormalized authorization fields are needed as security rules will leverage the `registerNumber`.",
          "params": [
            {
              "name": "registerNumber",
              "description": "The unique register number of the student. Serves as the document ID."
            }
          ]
        }
      },
      {
        "path": "/attendance/{attendanceId}",
        "definition": {
          "entityName": "Attendance",
          "schema": {
            "$ref": "#/backend/entities/Attendance"
          },
          "description": "Stores attendance records. Includes 'studentRegister' for querying attendance by student. The document ID is auto-generated.",
          "params": [
            {
              "name": "attendanceId",
              "description": "The auto-generated unique ID for the attendance document."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "AdminRole",
          "schema": {
            "$ref": "#/backend/entities/AdminRole"
          },
          "description": "Indicates the user with {uid} has admin role.  Authorization rules check for the existence of this document.",
          "params": [
            {
              "name": "uid",
              "description": "The Firebase Auth UID of the admin user."
            }
          ]
        }
      },
      {
        "path": "/teachers/{email}",
        "definition": {
          "entityName": "Teacher",
          "schema": {
            "$ref": "#/backend/entities/Teacher"
          },
          "description": "Stores teacher profile information. Document ID is the teacher's email.",
          "params": [
            {
              "name": "email",
              "description": "The unique email of the teacher. Serves as the document ID."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, in accordance with the defined principles.  Authorization Independence is achieved through denormalization. For example, the `attendance` collection denormalizes the `studentRegister` field, ensuring that attendance records can be queried and secured independently of the student document.  Structural Segregation is applied by using separate collections for `students` and `attendance`, each with specific security requirements. Access Modeling utilizes path-based ownership for student data (`/students/{registerNumber}`), and a top-level collection for `attendance` to enable efficient queries across all students. This structure supports secure `list` operations by ensuring that only authorized users can access the data within each collection, adhering to QAPs. Invariants like ownership and timestamps are enforced through security rules."
  }
}
